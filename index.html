<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¬Ø§Ø±Ù‡ ÙÙˆØªØ¨Ø§Ù„</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
<style>
body{font-family:tahoma;background:#f4f6fa;margin:20px}
.card{background:white;padding:20px;border-radius:15px;box-shadow:0 5px 20px rgba(0,0,0,.08);margin-bottom:25px}
button{background:#2962ff;color:white;border:none;padding:8px 15px;border-radius:8px;cursor:pointer;margin-top:5px}
button:hover{background:#0039cb}
input{padding:8px;border-radius:8px;border:1px solid #ccc;width:100%;margin:5px 0}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{padding:10px;border-bottom:1px solid #eee;text-align:center}
.status-green{color:green;font-weight:bold}
.status-red{color:red;font-weight:bold}
.status-zero{color:#555;font-weight:bold}
#clock{font-size:18px;font-weight:bold;margin-bottom:15px}
.session-day{background:#ff5252 !important;color:white !important;border-radius:50%;position:relative;}
.session-done::after{content:"âœ”";position:absolute;top:0;right:0;color:green;font-weight:bold;}
.summary{background:#e3f2fd;padding:10px;border-radius:10px;margin-top:10px}
</style>
</head>
<body>

<div id="clock"></div>

<div class="card">
<h2>ØªÙ†Ø¸ÛŒÙ… Ø³Ø§Ù†Ø³ Ù‡ÙØªÚ¯ÛŒ</h2>
<label>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ø¬Ù„Ø³Ù‡:</label>
<input type="text" id="startDate" readonly>
<label>ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª:</label>
<input type="number" id="sessionCountInput" min="1">
<label>Ø±ÙˆØ² Ù‡ÙØªÙ‡ (Ø´Ù†Ø¨Ù‡=6, ÛŒÚ©Ø´Ù†Ø¨Ù‡=0, Ø¯ÙˆØ´Ù†Ø¨Ù‡=1,... Ø¬Ù…Ø¹Ù‡=5):</label>
<input type="number" id="weekDayInput" min="0" max="6" value="1">
<label>Ù…Ø¨Ù„Øº Ù‡Ø± Ø¬Ù„Ø³Ù‡:</label>
<input type="text" id="sessionPrice" inputmode="numeric">

<button id="generateSessions">ØªÙˆÙ„ÛŒØ¯ Ø¬Ù„Ø³Ø§Øª</button>

<div class="summary">
<p>ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª: <span id="sessionCount">0</span></p>
<p>Ù…Ø¨Ù„Øº Ú©Ù„: <span id="totalCost">0</span></p>
<p>Ø³Ù‡Ù… Ù‡Ø± Ù†ÙØ± (Ø¬Ù„Ø³Ø§Øª Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ ØªÙ‚Ø³ÛŒÙ… Ø¨ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ÙØ¹Ù„ÛŒ): <span id="sharePerPlayer">0</span></p>
</div>
</div>

<div class="card">
<h2>ØªÙ‚ÙˆÛŒÙ… Ø¬Ù„Ø³Ø§Øª</h2>
<div id="calendar"></div>
</div>

<div class="card">
<h2>Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†</h2>
<input type="text" id="playerName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
<button onclick="addPlayer()">Ø§ÙØ²ÙˆØ¯Ù†</button>
</div>

<div class="card">
<h2>Ù„ÛŒØ³Øª Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</h2>
<table class="table">
<thead>
<tr>
<th>Ù†Ø§Ù…</th>
<th>Ø³Ù‡Ù…</th>
<th>Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</th>
<th>Ø¨Ø¯Ù‡ÛŒ / Ø·Ù„Ø¨</th>
<th>ÙˆØ¶Ø¹ÛŒØª</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="playersTable"></tbody>
</table>
</div>

<script>
let players = JSON.parse(localStorage.getItem("players")) || [];
let sessions = JSON.parse(localStorage.getItem("sessions")) || [];
let sessionPrice = JSON.parse(localStorage.getItem("sessionPrice")) || 0;

// Ø³Ø§Ø¹Øª Ø´Ù…Ø³ÛŒ
function updateClock() {
  let now = new persianDate();
  $("#clock").text("ğŸ“… " + now.format("YYYY/MM/DD") + " â° " + now.format("HH:mm:ss"));
}
setInterval(updateClock,1000);

// Ø´Ø±ÙˆØ¹ Ø¬Ù„Ø³Ù‡ picker
$("#startDate").persianDatepicker({format:"YYYY/MM/DD"});

// Ù…Ø¨Ù„Øº Ø¬Ù„Ø³Ù‡
$("#sessionPrice").val(sessionPrice?Number(sessionPrice).toLocaleString():'');
$("#sessionPrice").on("input",function(){
  let val = $(this).val().replace(/,/g,'');
  sessionPrice = Number(val);
  $(this).val(Number(val).toLocaleString());
  saveData();
  updateCalculations();
});

// Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†
function addPlayer(){
  let name=$("#playerName").val();
  if(!name)return;
  players.push({name,paid:0});
  $("#playerName").val("");
  saveData();
  updateCalculations();
}

// Ø­Ø°Ù Ø¨Ø§Ø²ÛŒÚ©Ù†
function deletePlayer(i){
  players.splice(i,1);
  saveData();
  updateCalculations();
}

// Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
function saveData(){
  localStorage.setItem("players",JSON.stringify(players));
  localStorage.setItem("sessions",JSON.stringify(sessions));
  localStorage.setItem("sessionPrice",JSON.stringify(sessionPrice));
}

// ØªÙˆÙ„ÛŒØ¯ Ø¬Ù„Ø³Ø§Øª Ù‡ÙØªÚ¯ÛŒ
$("#generateSessions").click(function(){
  let start=$("#startDate").val();
  let count = parseInt($("#sessionCountInput").val());
  let weekDay = parseInt($("#weekDayInput").val());

  if(!start || !count || count<1 || isNaN(weekDay)) { alert("Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ø¯Ø±Ø³Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"); return;}

  let pd = new persianDate(start);
  sessions = [];
  for(let i=0;i<count;i++){
    let newDate = pd.clone().add('week',i);
    sessions.push({date:newDate.format("YYYY/MM/DD"),done:false});
  }
  saveData();
  renderCalendar();
  updateCalculations();
});

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù‡Ù… Ùˆ Ø¨Ø¯Ù‡ÛŒ/Ø·Ù„Ø¨
function updateCalculations(){
  let totalCost = sessions.length * sessionPrice;
  $("#totalCost").text(Number(totalCost).toLocaleString());

  let remainingSessions = sessions.filter(s=>!s.done).length;
  let currentPlayers = players.length;
  let share = currentPlayers>0 ? Math.ceil((sessionPrice*remainingSessions)/currentPlayers) : 0;
  $("#sharePerPlayer").text(Number(share).toLocaleString());

  $("#playersTable").html("");
  players.forEach((p,i)=>{
    let debt = share - (p.paid||0);
    let status="ØªØ³ÙˆÛŒÙ‡",cls="status-zero";
    if(debt>0){status="Ø¨Ø¯Ù‡Ú©Ø§Ø±";cls="status-red"}
    if(debt<0){status="Ø·Ù„Ø¨Ú©Ø§Ø±";cls="status-green"}
    $("#playersTable").append(`
      <tr>
      <td>${p.name}</td>
      <td>${Number(share).toLocaleString()}</td>
      <td>${Number(p.paid||0).toLocaleString()}</td>
      <td>${Number(Math.abs(debt)).toLocaleString()}</td>
      <td class="${cls}">${status}</td>
      <td><button onclick="deletePlayer(${i})">Ø­Ø°Ù</button></td>
      </tr>
    `);
  });
}

// ØªÙ‚ÙˆÛŒÙ… Ø«Ø§Ø¨Øª
function renderCalendar(){
  $("#calendar").persianDatepicker("destroy");
  $("#calendar").persianDatepicker({
    inline:true,
    format:"YYYY/MM/DD",
    calendar:{persian:{locale:"fa"}},
    navigator:{enabled:true,scroll:{enabled:false}},
    onRender:function(date){
      let d=date.format("YYYY/MM/DD");
      let session = sessions.find(s=>s.date===d);
      if(session){
        let cls = "session-day";
        if(new persianDate(d).valueOf() < new persianDate().valueOf()) cls+=" session-done";
        return {className:cls};
      }
      return {};
    }
  });
}

function init(){
  renderCalendar();
  updateCalculations();
  updateClock();
}
init();
</script>
</body>
</html>
